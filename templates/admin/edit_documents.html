{% extends "admin/base.html" %}
{% block title %}–î–æ–∫—É–º–µ–Ω—Ç—ã ‚Äî –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å{% endblock %}

{% block admin_content %}
<div class="admin-page">
    <div class="admin-page__header">
        <h1>–î–æ–∫—É–º–µ–Ω—Ç—ã –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã</h1>
        <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–∞–Ω–∞–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –æ–± –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏ –∏ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏</p>
    </div>

    <form method="POST" class="admin-form" enctype="multipart/form-data">

        <!-- ‚ïê‚ïê‚ïê Page Settings ‚ïê‚ïê‚ïê -->
        <div class="admin-form__section">
            <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</h3>
            <div class="admin-field">
                <label for="title">–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</label>
                <input type="text" id="title" name="title" value="{{ content.documents_page.title }}">
            </div>
            <div class="admin-field">
                <label for="subtitle">–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
                <textarea id="subtitle" name="subtitle" rows="2">{{ content.documents_page.subtitle }}</textarea>
            </div>
            <div class="admin-field">
                <label for="button_text">–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ (–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ¬´–û–±–æ –º–Ω–µ¬ª)</label>
                <input type="text" id="button_text" name="button_text" value="{{ content.documents_page.button_text }}">
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê Existing Documents ‚ïê‚ïê‚ïê -->
        {% if content.documents_page.docs %}
        <div class="admin-form__section">
            <h3>üìÑ –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã</h3>
            <p style="color: var(--admin-text-muted); font-size: 0.875rem; margin-bottom: 1rem;">–ù–∞–∂–º–∏—Ç–µ ¬´–£–¥–∞–ª–∏—Ç—å¬ª —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç. –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—Ç—Å—è –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.</p>
            <div id="docsList">
                {% for doc in content.documents_page.docs %}
                <div class="admin-doc-item" id="docItem{{ loop.index0 }}" data-id="{{ loop.index0 }}">
                    <input type="hidden" name="doc_id" value="{{ loop.index0 }}">
                    <div class="admin-doc-item__preview">
                        <img src="{{ url_for('static', filename=doc.image) }}" alt="{{ doc.title }}">
                    </div>
                    <div class="admin-doc-item__info">
                        <input type="text" name="doc_title" value="{{ doc.title }}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
                        <div class="admin-doc-item__actions">
                            <a href="{{ url_for('static', filename=doc.image) }}" target="_blank" class="admin-btn admin-btn--outline admin-btn--sm">–û—Ç–∫—Ä—ã—Ç—å</a>
                            <button type="button" class="admin-btn admin-btn--danger admin-btn--sm" onclick="markDelete({{ loop.index0 }})">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            <div id="deleteInputs"></div>
        </div>
        {% endif %}

        <!-- ‚ïê‚ïê‚ïê Add New Documents ‚ïê‚ïê‚ïê -->
        <div class="admin-form__section">
            <h3>üìé –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã</h3>
            <div id="newDocs">
                <div class="admin-doc-new">
                    <div class="admin-upload-zone">
                        <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                        <input type="file" name="new_files" accept="image/*" onchange="onNewFile(this)">
                    </div>
                    <input type="text" name="new_file_title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" style="margin-top: 0.5rem;">
                </div>
            </div>
            <button type="button" class="admin-btn admin-btn--outline" onclick="addNewSlot()" style="margin-top: 0.75rem;">+ –ï—â—ë –¥–æ–∫—É–º–µ–Ω—Ç</button>
        </div>

        <button type="submit" class="admin-btn admin-btn--primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </form>
</div>

<script>
function markDelete(id) {
    const item = document.getElementById('docItem' + id);
    if (item) {
        item.style.opacity = '0.3';
        item.style.pointerEvents = 'none';
        // Remove the hidden doc_id so it won't be sent
        const hidden = item.querySelector('input[name="doc_id"]');
        if (hidden) hidden.remove();
        // Add delete marker
        const container = document.getElementById('deleteInputs');
        const inp = document.createElement('input');
        inp.type = 'hidden';
        inp.name = 'delete_doc';
        inp.value = id;
        container.appendChild(inp);
    }
}

function addNewSlot() {
    const container = document.getElementById('newDocs');
    const div = document.createElement('div');
    div.className = 'admin-doc-new';
    div.innerHTML = `
        <div class="admin-upload-zone">
            <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
            <input type="file" name="new_files" accept="image/*" onchange="onNewFile(this)">
        </div>
        <input type="text" name="new_file_title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" style="margin-top: 0.5rem;">
    `;
    container.appendChild(div);
}

function onNewFile(input) {
    if (input.files && input.files[0]) {
        const zone = input.closest('.admin-upload-zone');
        const p = zone.querySelector('p');
        if (p) p.textContent = input.files[0].name;
    }
}
</script>
{% endblock %}
